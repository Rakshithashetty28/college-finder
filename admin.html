<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body { font-family: Arial; background:#f4f6fb; padding:20px; }
form, .college { background:white; padding:20px; border-radius:10px; margin:15px auto; max-width:450px;}
input, button { width:100%; padding:10px; margin:8px 0; }
button { background:#28a745; color:white; border:none; cursor:pointer; border-radius:5px; }
.delete { background:red; margin-top:5px; }
.edit { background:#007bff; margin-top:5px; }
img { width:100%; border-radius:8px; }
#logoutBtn { background:#555; margin-bottom:20px; }
</style>
</head>
<body>

<h2>Admin Login</h2>
<form id="loginForm">
  <input name="email" placeholder="Admin Email" required>
  <input name="password" type="password" placeholder="Password" required>
  <button type="submit">Login</button>
  <p id="loginMessage"></p>
</form>

<button id="logoutBtn" style="display:none;">Logout</button>

<form id="collegeForm" style="display:none;">
  <h3 id="formTitle">Add College</h3>
  <input name="name" placeholder="College Name" required>
  <input name="course" placeholder="Course" required>
  <input name="location" placeholder="Location" required>
  <input name="contact" placeholder="Contact" required>
  <input name="image" placeholder="Image URL" required>
  <button type="submit">Save College</button>
  <p id="collegeMessage"></p>
</form>

<h3 style="text-align:center">All Colleges</h3>
<div id="collegeList"></div>

<script>
let token = "";
let editId = null;

const loginForm = document.getElementById("loginForm");
const collegeForm = document.getElementById("collegeForm");
const logoutBtn = document.getElementById("logoutBtn");

// LOGIN
loginForm.onsubmit = async (e) => {
  e.preventDefault();
  const res = await fetch("http://localhost:3000/admin/login", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      email: loginForm.email.value,
      password: loginForm.password.value
    })
  });
  const data = await res.json();
  if(data.success){
    token = data.token;
    loginForm.style.display="none";
    collegeForm.style.display="block";
    logoutBtn.style.display="block";
    loadColleges();
  } else {
    document.getElementById('loginMessage').innerText = data.message;
  }
};

// LOGOUT
logoutBtn.onclick = () => {
  token = "";
  editId = null;
  loginForm.style.display="block";
  collegeForm.style.display="none";
  logoutBtn.style.display="none";
  document.getElementById('collegeList').innerHTML = "";
};

// ADD / EDIT COLLEGE
collegeForm.onsubmit = async (e) => {
  e.preventDefault();
  const collegeData = {
    name: collegeForm.name.value,
    course: collegeForm.course.value,
    location: collegeForm.location.value,
    contact: collegeForm.contact.value,
    image: collegeForm.image.value
  };
  let url = "http://localhost:3000/admin/addCollege";
  let method = "POST";
  if(editId){
    url = `http://localhost:3000/admin/editCollege/${editId}`;
    method = "PUT";
  }
  const res = await fetch(url, {
    method,
    headers:{ "Content-Type":"application/json", "Authorization": token },
    body: JSON.stringify(collegeData)
  });
  const data = await res.json();
  document.getElementById('collegeMessage').innerText = data.success ? "Saved successfully!" : data.message;
  collegeForm.reset();
  editId = null;
  document.getElementById("formTitle").innerText = "Add College";
  loadColleges();
};

// LOAD COLLEGES
async function loadColleges(){
  const res = await fetch("http://localhost:3000/colleges");
  const colleges = await res.json();
  const list = document.getElementById("collegeList");
  list.innerHTML = "";
  colleges.forEach(c => {
    list.innerHTML += `
      <div class="college">
        ${c.image ? `<img src="${c.image}">` : ""}
        <h4>${c.name}</h4>
        <p>${c.course} | ${c.location}</p>
        <p>${c.contact}</p>
        <button class="edit" onclick="editCollege('${c._id}','${c.name}','${c.course}','${c.location}','${c.contact}','${c.image}')">Edit</button>
        <button class="delete" onclick="deleteCollege('${c._id}')">Delete</button>
      </div>
    `;
  });
}

// EDIT COLLEGE
function editCollege(id,name,course,location,contact,image){
  editId = id;
  document.getElementById("formTitle").innerText = "Edit College";
  collegeForm.name.value = name;
  collegeForm.course.value = course;
  collegeForm.location.value = location;
  collegeForm.contact.value = contact;
  collegeForm.image.value = image;
}

// DELETE COLLEGE
async function deleteCollege(id){
  if(!confirm("Delete this college?")) return;
  await fetch(`http://localhost:3000/admin/deleteCollege/${id}`,{
    method:"DELETE",
    headers:{ "Authorization": token }
  });
  loadColleges();
}
</script>

</body>
</html>
